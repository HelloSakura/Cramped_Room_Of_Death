{"version":3,"sources":["file:///E:/git/Cramped_Room_Of_Death/assets/scripts/door/DoorManager.ts"],"names":["_decorator","DIRECTION_ENUM","ENTITY_STATE_ENUM","ENTITY_TYPE_ENUM","EVENT_ENUM","EventManager","EntityManager","DoorStateMachine","DataManager","ccclass","property","DoorManager","onDestroy","Instance","off","DOOR_OPEN","_onOpen","init","fsm","addComponent","x","y","type","DOOR","direction","TOP","state","IDLE","on","enemies","every","enemy","DEATH"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;;AACCC,MAAAA,c,iBAAAA,c;AAAgBC,MAAAA,iB,iBAAAA,iB;AAAmBC,MAAAA,gB,iBAAAA,gB;AAAkBC,MAAAA,U,iBAAAA,U;;AACxDC,MAAAA,Y;;AACEC,MAAAA,a,iBAAAA,a;;AACAC,MAAAA,gB,iBAAAA,gB;;AACFC,MAAAA,W;;;;;;;;;OACD;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBV,U;;6BAMjBW,W,WADZF,OAAO,CAAC,aAAD,C,gBAAR,MACaE,WADb;AAAA;AAAA,0CAC+C;AAE3CC,QAAAA,SAAS,GAAS;AACd,gBAAMA,SAAN;AACA;AAAA;AAAA,4CAAaC,QAAb,CAAsBC,GAAtB,CAA0B;AAAA;AAAA,wCAAWC,SAArC,EAAgD,KAAKC,OAArD;AACH;;AAES,cAAJC,IAAI,GAAE;AACR;AACA,eAAKC,GAAL,GAAW,KAAKC,YAAL;AAAA;AAAA,mDAAX;AACA,gBAAM,KAAKD,GAAL,CAASD,IAAT,EAAN;AACA,gBAAMA,IAAN,CAAW;AACPG,YAAAA,CAAC,EAAC,CADK;AAEPC,YAAAA,CAAC,EAAC,CAFK;AAGPC,YAAAA,IAAI,EAAE;AAAA;AAAA,sDAAiBC,IAHhB;AAIPC,YAAAA,SAAS,EAAC;AAAA;AAAA,kDAAeC,GAJlB;AAKPC,YAAAA,KAAK,EAAC;AAAA;AAAA,wDAAkBC;AALjB,WAAX;AAOA;AAAA;AAAA,4CAAad,QAAb,CAAsBe,EAAtB,CAAyB;AAAA;AAAA,wCAAWb,SAApC,EAA+C,KAAKC,OAApD,EAA6D,IAA7D;AAEH;;AAEOA,QAAAA,OAAO,GAAE;AACb,cAAG;AAAA;AAAA,0CAAYH,QAAZ,CAAqBgB,OAArB,CAA6BC,KAA7B,CAAmCC,KAAK,IAAEA,KAAK,CAACL,KAAN,KAAgB;AAAA;AAAA,sDAAkBM,KAA5E,KACA,KAAKN,KAAL,KAAe;AAAA;AAAA,sDAAkBM,KADpC,EAEC;AACG,iBAAKN,KAAL,GAAa;AAAA;AAAA,wDAAkBM,KAA/B;AACH;AACJ;;AA5B0C,O","sourcesContent":["import { _decorator } from 'cc';\r\nimport {  DIRECTION_ENUM, ENTITY_STATE_ENUM, ENTITY_TYPE_ENUM, EVENT_ENUM } from '../../enums';\r\nimport EventManager from '../../runtime/EventManager';\r\nimport { EntityManager } from '../../base/EntityManager';\r\nimport { DoorStateMachine } from './DoorStateMachine';\r\nimport DataManager from '../../runtime/DataManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n\r\n\r\n\r\n@ccclass('DoorManager')\r\nexport class DoorManager extends EntityManager {\r\n    \r\n    onDestroy(): void {\r\n        super.onDestroy();\r\n        EventManager.Instance.off(EVENT_ENUM.DOOR_OPEN, this._onOpen); \r\n    }\r\n    \r\n    async init(){   \r\n        //添加状态机\r\n        this.fsm = this.addComponent(DoorStateMachine);\r\n        await this.fsm.init();\r\n        super.init({\r\n            x:7,\r\n            y:8,\r\n            type: ENTITY_TYPE_ENUM.DOOR,\r\n            direction:DIRECTION_ENUM.TOP,\r\n            state:ENTITY_STATE_ENUM.IDLE\r\n        });\r\n        EventManager.Instance.on(EVENT_ENUM.DOOR_OPEN, this._onOpen, this);\r\n   \r\n    }\r\n\r\n    private _onOpen(){\r\n        if(DataManager.Instance.enemies.every(enemy=>enemy.state === ENTITY_STATE_ENUM.DEATH) \r\n        && this.state !== ENTITY_STATE_ENUM.DEATH\r\n        ){\r\n            this.state = ENTITY_STATE_ENUM.DEATH;\r\n        }\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\n"]}