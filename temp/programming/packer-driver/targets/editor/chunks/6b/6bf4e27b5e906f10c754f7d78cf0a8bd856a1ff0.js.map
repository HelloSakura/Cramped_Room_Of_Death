{"version":3,"sources":["file:///E:/cocos_project/Cramed_of_death/assets/scripts/tile/TileMapManager.ts"],"names":["_decorator","Component","TileManger","createUINode","randomByRange","DataManager","ResourceManager","ccclass","property","TileMapManager","init","spriteFrames","Instance","loadDir","mapInfo","tileInfo","i","length","column","j","item","src","type","node","number","imageSrc","spriteFrame","find","v","name","tileManger","addComponent","setParent"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;;AAIZC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,Y,iBAAAA,Y;AAAcC,MAAAA,a,iBAAAA,a;;AAChBC,MAAAA,W;;AACAC,MAAAA,e;;;;;;;;;OAND;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBR,U,GAE9B;;gCASaS,c,WADZF,OAAO,CAAC,gBAAD,C,gBAAR,MACaE,cADb,SACoCR,SADpC,CAC8C;AAChC,cAAJS,IAAI,GAAE;AACR,gBAAMC,YAAY,GAAG,MAAM;AAAA;AAAA,kDAAgBC,QAAhB,CAAyBC,OAAzB,CAAiC,mBAAjC,CAA3B;AACA,gBAAM;AAACC,YAAAA;AAAD,cAAY;AAAA;AAAA,0CAAYF,QAA9B;AACA;AAAA;AAAA,0CAAYA,QAAZ,CAAqBG,QAArB,GAAgC,EAAhC,CAHQ,CAIR;;AACA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,OAAO,CAACG,MAA5B,EAAoCD,CAAC,EAArC,EAAyC;AACrC,kBAAME,MAAM,GAAGJ,OAAO,CAACE,CAAD,CAAtB;AACA;AAAA;AAAA,4CAAYJ,QAAZ,CAAqBG,QAArB,CAA8BC,CAA9B,IAAmC,EAAnC;;AACA,iBAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,MAAM,CAACD,MAA3B,EAAmCE,CAAC,EAApC,EAAwC;AACpC,oBAAMC,IAAI,GAAGF,MAAM,CAACC,CAAD,CAAnB,CADoC,CAEpC;;AACA,kBAAGC,IAAI,CAACC,GAAL,KAAa,IAAb,IAAqBD,IAAI,CAACE,IAAL,KAAc,IAAtC,EAA2C;AACvC;AACH;;AAED,oBAAMC,IAAI,GAAG;AAAA;AAAA,iDAAb,CAPoC,CASpC;;AACA,kBAAIC,MAAM,GAAGJ,IAAI,CAACC,GAAlB;;AACA,kBAAG,CAACG,MAAM,KAAK,CAAX,IAAgBA,MAAM,KAAK,CAA3B,IAAgCA,MAAM,KAAK,CAA5C,KAAkDR,CAAC,GAAC,CAAF,KAAQ,CAA1D,IAA+DG,CAAC,GAAC,CAAF,KAAQ,CAA1E,EAA4E;AACxEK,gBAAAA,MAAM,IAAI;AAAA;AAAA,oDAAc,CAAd,EAAiB,CAAjB,CAAV;AACH;;AACD,oBAAMC,QAAQ,GAAI,SAAQD,MAAO,GAAjC;AAEA,oBAAME,WAAW,GAAGf,YAAY,CAACgB,IAAb,CAAkBC,CAAC,IAAIA,CAAC,CAACC,IAAF,KAAWJ,QAAlC,KAA+Cd,YAAY,CAAC,CAAD,CAA/E,CAhBoC,CAkBpC;;AACA,oBAAMmB,UAAU,GAAGP,IAAI,CAACQ,YAAL;AAAA;AAAA,2CAAnB;AACA,oBAAMT,IAAI,GAAGF,IAAI,CAACE,IAAlB;AACAQ,cAAAA,UAAU,CAACpB,IAAX,CAAgBY,IAAhB,EAAsBI,WAAtB,EAAmCV,CAAnC,EAAsCG,CAAtC;AACA;AAAA;AAAA,8CAAYP,QAAZ,CAAqBG,QAArB,CAA8BC,CAA9B,EAAiCG,CAAjC,IAAsCW,UAAtC;AACAP,cAAAA,IAAI,CAACS,SAAL,CAAe,KAAKT,IAApB;AAEA;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGa;AAEJ;AACJ;;AAnDyC,O","sourcesContent":["import { _decorator, Component, random, resources, SpriteFrame} from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n//导入瓦片信息\r\nimport { TileManger } from './TileManger';\r\nimport { createUINode, randomByRange } from '../../utils';\r\nimport DataManager from '../../runtime/DataManager';\r\nimport ResourceManager from '../../runtime/ResourceManager';\r\n\r\n\r\n\r\n@ccclass('TileMapManager')\r\nexport class TileMapManager extends Component {\r\n    async init(){\r\n        const spriteFrames = await ResourceManager.Instance.loadDir(\"texture/tile/tile\");\r\n        const {mapInfo} = DataManager.Instance;\r\n        DataManager.Instance.tileInfo = [];\r\n        //console.log(spriteFrames);\r\n        for (let i = 0; i < mapInfo.length; i++) {\r\n            const column = mapInfo[i];\r\n            DataManager.Instance.tileInfo[i] = [];\r\n            for (let j = 0; j < column.length; j++) {\r\n                const item = column[j];\r\n                //空值跳过\r\n                if(item.src === null || item.type === null){\r\n                    continue;\r\n                }\r\n\r\n                const node = createUINode();\r\n\r\n                //随机地板\r\n                let number = item.src;\r\n                if((number === 1 || number === 5 || number === 9) && i%2 === 0 && j%2 === 0){\r\n                    number += randomByRange(0, 4);\r\n                }\r\n                const imageSrc = `tile (${number})`;\r\n\r\n                const spriteFrame = spriteFrames.find(v => v.name === imageSrc) || spriteFrames[0];\r\n                \r\n                //添加瓦片管理类，主要是之前太难看得封装一下\r\n                const tileManger = node.addComponent(TileManger);\r\n                const type = item.type;\r\n                tileManger.init(type, spriteFrame, i, j);\r\n                DataManager.Instance.tileInfo[i][j] = tileManger;\r\n                node.setParent(this.node);\r\n\r\n                /*封装以下到TileManager类\r\n                //添加UI组件定义大小\r\n                const node = new Node();\r\n                const transform = node.addComponent(UITransform);\r\n                transform.setContentSize(TILE_WIDTH, TILE_HEIGHT);\r\n\r\n                //设置layer\r\n                node.layer = 1 << Layers.nameToLayer(\"UI_2D\");\r\n\r\n                //设置位置\r\n                node.setPosition(i*TILE_WIDTH, -j*TILE_HEIGHT);\r\n                //挂载到父节点\r\n                node.setParent(this.node);\r\n                */\r\n            }\r\n            \r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}