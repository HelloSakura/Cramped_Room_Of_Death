{"version":3,"sources":["file:///G:/github/Cramped_Room_Of_Death/assets/base/EntityManager.ts"],"names":["_decorator","Component","Sprite","UITransform","PARAMS_NAME_ENUM","DIRECTION_ORDER_ENUM","TILE_WIDTH","TILE_HEIGHT","ccclass","property","EntityManager","x","y","fsm","_direction","_state","type","direction","newDirection","setParams","DIRECTION","state","newState","init","params","sprite","addComponent","sizeMode","SizeMode","CUSTOM","transform","getComponent","setContentSize","update","node","setPosition"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,W,OAAAA,W;;AACIC,MAAAA,gB,iBAAAA,gB;AAAkBC,MAAAA,oB,iBAAAA,oB;;AACrDC,MAAAA,U,iBAAAA,U;AAAYC,MAAAA,W,iBAAAA,W;;;;;;;;;OAIf;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBT,U;;+BAMjBU,a,WADZF,OAAO,CAAC,eAAD,C,gBAAR,MACaE,aADb,SACmCT,SADnC,CAC6C;AAAA;AAAA;AAAA,eAEzCU,CAFyC,GAE9B,CAF8B;AAAA,eAGzCC,CAHyC,GAG9B,CAH8B;AAKzC;AALyC,eAMzCC,GANyC;AAAA,eAQjCC,UARiC;AAAA,eASjCC,MATiC;AAAA,eAUjCC,IAViC;AAAA;;AAY5B,YAATC,SAAS,GAAE;AACX,iBAAO,KAAKH,UAAZ;AACH;;AAEY,YAATG,SAAS,CAACC,YAAD,EAA8B;AACvC,eAAKJ,UAAL,GAAkBI,YAAlB;AACA,eAAKL,GAAL,CAASM,SAAT,CAAmB;AAAA;AAAA,oDAAiBC,SAApC,EAA+C;AAAA;AAAA,4DAAqB,KAAKN,UAA1B,CAA/C;AACH;;AAEQ,YAALO,KAAK,GAAE;AACP,iBAAO,KAAKN,MAAZ;AACH;;AAEQ,YAALM,KAAK,CAACC,QAAD,EAA6B;AAClC,eAAKP,MAAL,GAAcO,QAAd;AACA,eAAKT,GAAL,CAASM,SAAT,CAAmB,KAAKJ,MAAxB,EAAgC,IAAhC;AACH;;AAGS,cAAJQ,IAAI,CAACC,MAAD,EAAiB;AACvB;AACA;AACA,gBAAMC,MAAM,GAAG,KAAKC,YAAL,CAAkBxB,MAAlB,CAAf,CAHuB,CAIvB;;AACAuB,UAAAA,MAAM,CAACE,QAAP,GAAkBzB,MAAM,CAAC0B,QAAP,CAAgBC,MAAlC,CALuB,CAMvB;;AACA,gBAAMC,SAAS,GAAG,KAAKC,YAAL,CAAkB5B,WAAlB,CAAlB;AACA2B,UAAAA,SAAS,CAACE,cAAV,CAAyB;AAAA;AAAA,0CAAW,CAApC,EAAuC;AAAA;AAAA,4CAAY,CAAnD;AAGA,eAAKrB,CAAL,GAASa,MAAM,CAACb,CAAhB;AACA,eAAKC,CAAL,GAASY,MAAM,CAACZ,CAAhB;AACA,eAAKI,IAAL,GAAYQ,MAAM,CAACR,IAAnB;AACA,eAAKF,UAAL,GAAkBU,MAAM,CAACP,SAAzB;AACA,eAAKI,KAAL,GAAaG,MAAM,CAACH,KAApB;AACH;;AAEDY,QAAAA,MAAM,GAAE;AACJ;AACA;AACA;AACA,eAAKC,IAAL,CAAUC,WAAV,CAAsB,KAAKxB,CAAL;AAAA;AAAA,0CAAsB;AAAA;AAAA,0CAAa,GAAzD,EAA8D,CAAC,KAAKC,CAAN;AAAA;AAAA,4CAAwB;AAAA;AAAA,4CAAc,GAApG;AACH;;AAtDwC,O","sourcesContent":["import { _decorator, Component, Sprite, UITransform } from 'cc';\r\nimport { DIRECTION_ENUM, ENTITY_STATE_ENUM, PARAMS_NAME_ENUM, DIRECTION_ORDER_ENUM, ENTITY_TYPE_ENUM } from '../enums';\r\nimport { TILE_WIDTH, TILE_HEIGHT } from '../scripts/tile/TileManger';\r\nimport { IEntity } from '../levels';\r\nimport { StateMachine } from './StateMachine';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n\r\n\r\n\r\n@ccclass('EntityManager')\r\nexport class EntityManager extends Component {\r\n\r\n    x:number = 0;\r\n    y:number = 0;\r\n\r\n    //状态机\r\n    fsm: StateMachine;\r\n\r\n    private _direction:DIRECTION_ENUM;\r\n    private _state:ENTITY_STATE_ENUM;\r\n    private type:ENTITY_TYPE_ENUM;\r\n\r\n    get direction(){\r\n        return this._direction;\r\n    }\r\n\r\n    set direction(newDirection: DIRECTION_ENUM){\r\n        this._direction = newDirection;\r\n        this.fsm.setParams(PARAMS_NAME_ENUM.DIRECTION, DIRECTION_ORDER_ENUM[this._direction]);\r\n    }\r\n\r\n    get state(){\r\n        return this._state;\r\n    }\r\n\r\n    set state(newState: ENTITY_STATE_ENUM){\r\n        this._state = newState;\r\n        this.fsm.setParams(this._state, true);\r\n    }\r\n\r\n\r\n    async init(params: IEntity){\r\n        //动画模块\r\n        //添加一个spite组件\r\n        const sprite = this.addComponent(Sprite); \r\n        //设置为custom模式，可以自定义宽高\r\n        sprite.sizeMode = Sprite.SizeMode.CUSTOM;\r\n        //设置宽高\r\n        const transform = this.getComponent(UITransform);\r\n        transform.setContentSize(TILE_WIDTH*4, TILE_HEIGHT*4);\r\n\r\n\r\n        this.x = params.x;\r\n        this.y = params.y;\r\n        this.type = params.type;\r\n        this._direction = params.direction;\r\n        this.state = params.state;\r\n    }\r\n\r\n    update(){\r\n        //虚拟坐标转换为瓦片坐标\r\n        //瓦片地图左上角为原点\r\n        //注意人物大小与瓦片之间的偏移\r\n        this.node.setPosition(this.x * TILE_WIDTH - TILE_WIDTH * 1.5, -this.y * TILE_HEIGHT + TILE_HEIGHT * 1.5);\r\n    }\r\n\r\n}\r\n\r\n\r\n"]}