{"version":3,"sources":["file:///E:/git/Cramped_Room_Of_Death/assets/base/EnemyManager.ts"],"names":["_decorator","EVENT_ENUM","DIRECTION_ENUM","ENTITY_STATE_ENUM","DataManager","EventManager","EntityManager","ccclass","property","EnemyManager","onDestroy","Instance","off","PLAYER_BORN","_onChangeDirection","PLAYER_MOVE_END","ATTACK_ENEMY","_onDead","init","params","on","isInit","state","DEATH","player","x","playerX","y","playerY","disX","Math","abs","disY","direction","TOP","RIGHT","LEFT","BOTTOM","id"],"mappings":"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","sourcesContent":["import { _decorator } from 'cc';\r\nimport { EVENT_ENUM, ENTITY_TYPE_ENUM, DIRECTION_ENUM, ENTITY_STATE_ENUM } from '../enums';\r\nimport DataManager from '../runtime/DataManager';\r\nimport EventManager from '../runtime/EventManager';\r\nimport { WoodenSkeletonStateMachine } from '../scripts/woodenSkeleton/WoodenSkeletonStateMachine';\r\nimport { EntityManager } from './EntityManager';\r\nimport { IEntity } from '../levels';\r\nconst { ccclass, property } = _decorator;\r\n\r\n\r\n\r\n\r\n@ccclass('EnemyManager')\r\nexport class EnemyManager extends EntityManager {\r\n    \r\n    onDestroy(): void {\r\n        super.onDestroy();\r\n        EventManager.Instance.off(EVENT_ENUM.PLAYER_BORN, this._onChangeDirection);\r\n        EventManager.Instance.off(EVENT_ENUM.PLAYER_MOVE_END, this._onChangeDirection);\r\n        EventManager.Instance.off(EVENT_ENUM.ATTACK_ENEMY, this._onDead);    \r\n    }\r\n    \r\n    async init(params: IEntity){   \r\n        //添加状态机\r\n        super.init(params);\r\n        EventManager.Instance.on(EVENT_ENUM.PLAYER_BORN, this._onChangeDirection, this);\r\n        EventManager.Instance.on(EVENT_ENUM.PLAYER_MOVE_END, this._onChangeDirection, this);\r\n        EventManager.Instance.on(EVENT_ENUM.ATTACK_ENEMY, this._onDead, this);\r\n\r\n        //保证不管是敌人先生成or玩家先生成都会判断\r\n        this._onChangeDirection(true);\r\n    }\r\n\r\n    private _onChangeDirection(isInit:boolean = false){\r\n        if(this.state === ENTITY_STATE_ENUM.DEATH || !DataManager.Instance.player) return;\r\n\r\n        const {x:playerX, y:playerY} = DataManager.Instance.player;\r\n        const disX = Math.abs(this.x - playerX);\r\n        const disY = Math.abs(this.y - playerY);\r\n\r\n        if(disX === disY && !isInit){\r\n            return;\r\n        }\r\n\r\n        if(playerX >= this.x && playerY <= this.y){\r\n            this.direction = disY > disX ? DIRECTION_ENUM.TOP : DIRECTION_ENUM.RIGHT;\r\n        }\r\n        else if(playerX <= this.x && playerY <= this.y){\r\n            this.direction = disY > disX ? DIRECTION_ENUM.TOP : DIRECTION_ENUM.LEFT;\r\n        }\r\n        else if(playerX <= this.x && playerY >= this.y){\r\n            this.direction = disY > disX ? DIRECTION_ENUM.BOTTOM : DIRECTION_ENUM.LEFT;\r\n        }\r\n        else if(playerX >= this.x && playerY >= this.y){\r\n            this.direction = disY > disX ? DIRECTION_ENUM.BOTTOM : DIRECTION_ENUM.RIGHT;\r\n        }\r\n    }\r\n\r\n\r\n    private _onDead(id:string){\r\n        if(this.state === ENTITY_STATE_ENUM.DEATH){\r\n            return\r\n        }\r\n\r\n        if(this.id === id){\r\n            this.state = ENTITY_STATE_ENUM.DEATH;\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}