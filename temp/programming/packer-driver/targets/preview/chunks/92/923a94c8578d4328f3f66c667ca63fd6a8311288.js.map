{"version":3,"sources":["file:///E:/git/Cramped_Room_Of_Death/assets/scripts/door/DoorManager.ts"],"names":["_decorator","ENTITY_STATE_ENUM","EVENT_ENUM","EventManager","EntityManager","DoorStateMachine","DataManager","ccclass","property","DoorManager","onDestroy","Instance","off","DOOR_OPEN","_onOpen","init","params","fsm","addComponent","on","enemies","every","enemy","state","DEATH"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;;AACiBC,MAAAA,iB,iBAAAA,iB;AAAqCC,MAAAA,U,iBAAAA,U;;AACxDC,MAAAA,Y;;AACEC,MAAAA,a,iBAAAA,a;;AACAC,MAAAA,gB,iBAAAA,gB;;AACFC,MAAAA,W;;;;;;;;;OAED;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBR,U;;6BAMjBS,W,WADZF,OAAO,CAAC,aAAD,C,gBAAR,MACaE,WADb;AAAA;AAAA,0CAC+C;AAE3CC,QAAAA,SAAS,GAAS;AACd,gBAAMA,SAAN;AACA;AAAA;AAAA,4CAAaC,QAAb,CAAsBC,GAAtB,CAA0B;AAAA;AAAA,wCAAWC,SAArC,EAAgD,KAAKC,OAArD;AACH;;AAEKC,QAAAA,IAAI,CAACC,MAAD,EAAgB;AAAA;AAAA;;AAAA;AACtB;AACA,YAAA,KAAI,CAACC,GAAL,GAAW,KAAI,CAACC,YAAL;AAAA;AAAA,qDAAX;AACA,kBAAM,KAAI,CAACD,GAAL,CAASF,IAAT,EAAN;;AACA,6CAAWC,MAAX;;AACA;AAAA;AAAA,8CAAaL,QAAb,CAAsBQ,EAAtB,CAAyB;AAAA;AAAA,0CAAWN,SAApC,EAA+C,KAAI,CAACC,OAApD,EAA6D,KAA7D;AALsB;AAOzB;;AAEOA,QAAAA,OAAO,GAAE;AACb,cAAG;AAAA;AAAA,0CAAYH,QAAZ,CAAqBS,OAArB,CAA6BC,KAA7B,CAAmCC,KAAK,IAAEA,KAAK,CAACC,KAAN,KAAgB;AAAA;AAAA,sDAAkBC,KAA5E,KACA,KAAKD,KAAL,KAAe;AAAA;AAAA,sDAAkBC,KADpC,EAEC;AACG,iBAAKD,KAAL,GAAa;AAAA;AAAA,wDAAkBC,KAA/B;AACH;AACJ;;AAtB0C,O","sourcesContent":["import { _decorator } from 'cc';\r\nimport {  DIRECTION_ENUM, ENTITY_STATE_ENUM, ENTITY_TYPE_ENUM, EVENT_ENUM } from '../../enums';\r\nimport EventManager from '../../runtime/EventManager';\r\nimport { EntityManager } from '../../base/EntityManager';\r\nimport { DoorStateMachine } from './DoorStateMachine';\r\nimport DataManager from '../../runtime/DataManager';\r\nimport { IEntity } from '../../levels';\r\nconst { ccclass, property } = _decorator;\r\n\r\n\r\n\r\n\r\n@ccclass('DoorManager')\r\nexport class DoorManager extends EntityManager {\r\n    \r\n    onDestroy(): void {\r\n        super.onDestroy();\r\n        EventManager.Instance.off(EVENT_ENUM.DOOR_OPEN, this._onOpen); \r\n    }\r\n    \r\n    async init(params:IEntity){   \r\n        //添加状态机\r\n        this.fsm = this.addComponent(DoorStateMachine);\r\n        await this.fsm.init();\r\n        super.init(params);\r\n        EventManager.Instance.on(EVENT_ENUM.DOOR_OPEN, this._onOpen, this);\r\n   \r\n    }\r\n\r\n    private _onOpen(){\r\n        if(DataManager.Instance.enemies.every(enemy=>enemy.state === ENTITY_STATE_ENUM.DEATH) \r\n        && this.state !== ENTITY_STATE_ENUM.DEATH\r\n        ){\r\n            this.state = ENTITY_STATE_ENUM.DEATH;\r\n        }\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\n"]}