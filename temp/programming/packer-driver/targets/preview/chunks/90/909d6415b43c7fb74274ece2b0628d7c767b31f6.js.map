{"version":3,"sources":["file:///E:/git/Cramped_Room_Of_Death/assets/scripts/scenes/BattleManager.ts"],"names":["_decorator","Component","Node","TileMapManager","levels","DataManager","TILE_HEIGHT","TILE_WIDTH","EventManager","ENTITY_STATE_ENUM","ENTITY_TYPE_ENUM","EVENT_ENUM","createUINode","PlayerManager","WoodenSkeletonManager","DoorManager","IronSkeletonManager","BurstManager","SpikeManager","SmokeManager","ccclass","property","BattleManager","level","stage","_smokeLayer","onLoad","Instance","levelIndex","on","NEXT_LEVEL","_nextLevel","PLAYER_MOVE_END","_checkArrivedDoor","SHOW_SMOKE","generateSmoke","onDestroy","off","start","generateStage","initLevel","clearLevel","mapInfo","mapRowCount","length","mapColumnCount","Promise","all","generateTileMap","generateBurst","generateSpikes","generateDoor","generateEnemy","generateSmokeLayer","generatePlayer","player","door","x","playerX","y","playerY","doorX","doorY","state","doorState","DEATH","emit","destroyAllChildren","reset","setParent","node","name","tileMap","tileMapManager","addComponent","init","adaptPos","promise","bursts","forEach","burst","manger","push","playManager","PLAYER_BORN","spikes","spike","doorManager","enemies","enemy","Manger","type","SKELETON_WOODEN","direction","item","smokes","find","smoke","setPosition","smokeManager","IDLE","SMOKE","disX","disY"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAqBC,MAAAA,I,OAAAA,I;;AACjCC,MAAAA,c,iBAAAA,c;;AACFC,MAAAA,M;;AACAC,MAAAA,W;;AACEC,MAAAA,W,iBAAAA,W;AAAaC,MAAAA,U,iBAAAA,U;;AACfC,MAAAA,Y;;AACkBC,MAAAA,iB,iBAAAA,iB;AAAmBC,MAAAA,gB,iBAAAA,gB;AAAkBC,MAAAA,U,iBAAAA,U;;AACrDC,MAAAA,Y,iBAAAA,Y;;AACAC,MAAAA,a,iBAAAA,a;;AACAC,MAAAA,qB,kBAAAA,qB;;AACAC,MAAAA,W,kBAAAA,W;;AACAC,MAAAA,mB,kBAAAA,mB;;AACAC,MAAAA,Y,kBAAAA,Y;;AACAC,MAAAA,Y,kBAAAA,Y;;AACAC,MAAAA,Y,kBAAAA,Y;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBrB,U;;+BAGjBsB,a,WADZF,OAAO,CAAC,eAAD,C,gBAAR,MACaE,aADb,SACmCrB,SADnC,CAC6C;AAAA;AAAA;AAAA,eACzCsB,KADyC;AAAA,eAEzCC,KAFyC;AAGzC;AAHyC,eAIjCC,WAJiC;AAAA;;AAMzC;AACAC,QAAAA,MAAM,GAAE;AACJ;AAAA;AAAA,0CAAYC,QAAZ,CAAqBC,UAArB,GAAkC,CAAlC,CADI,CAEJ;;AACA;AAAA;AAAA,4CAAaD,QAAb,CAAsBE,EAAtB,CAAyB;AAAA;AAAA,wCAAWC,UAApC,EAAgD,KAAKC,UAArD,EAAiE,IAAjE;AACA;AAAA;AAAA,4CAAaJ,QAAb,CAAsBE,EAAtB,CAAyB;AAAA;AAAA,wCAAWG,eAApC,EAAqD,KAAKC,iBAA1D,EAA6E,IAA7E;AACA;AAAA;AAAA,4CAAaN,QAAb,CAAsBE,EAAtB,CAAyB;AAAA;AAAA,wCAAWK,UAApC,EAAgD,KAAKC,aAArD,EAAoE,IAApE;AACH;;AAEDC,QAAAA,SAAS,GAAE;AACP;AACA;AAAA;AAAA,4CAAaT,QAAb,CAAsBU,GAAtB,CAA0B;AAAA;AAAA,wCAAWP,UAArC,EAAiD,KAAKC,UAAtD;AACA;AAAA;AAAA,4CAAaJ,QAAb,CAAsBU,GAAtB,CAA0B;AAAA;AAAA,wCAAWL,eAArC,EAAsD,KAAKC,iBAA3D;AACA;AAAA;AAAA,4CAAaN,QAAb,CAAsBU,GAAtB,CAA0B;AAAA;AAAA,wCAAWH,UAArC,EAAiD,KAAKC,aAAtD,EAAqE,IAArE;AACH;;AAEDG,QAAAA,KAAK,GAAG;AACJ,eAAKC,aAAL;AACA,eAAKC,SAAL;AACH;;AAEKA,QAAAA,SAAS,GAAE;AAAA;;AAAA;AACb,gBAAMjB,KAAK,GAAG;AAAA;AAAA,4CAAe;AAAA;AAAA,4CAAYI,QAAZ,CAAqBC,UAApC,CAAd;;AACA,gBAAGL,KAAH,EAAS;AACL,cAAA,KAAI,CAACkB,UAAL;;AACA,cAAA,KAAI,CAAClB,KAAL,GAAaA,KAAb;AACA;AAAA;AAAA,8CAAYI,QAAZ,CAAqBe,OAArB,GAA+B,KAAI,CAACnB,KAAL,CAAWmB,OAA1C;AACA;AAAA;AAAA,8CAAYf,QAAZ,CAAqBgB,WAArB,GAAmC,KAAI,CAACpB,KAAL,CAAWmB,OAAX,CAAmBE,MAAnB,IAA6B,CAAhE;AACA;AAAA;AAAA,8CAAYjB,QAAZ,CAAqBkB,cAArB,GAAsC,KAAI,CAACtB,KAAL,CAAWmB,OAAX,CAAmB,CAAnB,EAAsBE,MAAtB,IAAgC,CAAtE;AAEA,oBAAME,OAAO,CAACC,GAAR,CAAY,CACd,KAAI,CAACC,eAAL,EADc,EAEd,KAAI,CAACC,aAAL,EAFc,EAGd,KAAI,CAACC,cAAL,EAHc,EAId,KAAI,CAACC,YAAL,EAJc,EAKd,KAAI,CAACC,aAAL,EALc,CAAZ,CAAN,CAPK,CAcL;;AACA,oBAAM,KAAI,CAACC,kBAAL,EAAN;AACA,oBAAM,KAAI,CAACC,cAAL,EAAN;AAGH;AArBY;AAsBhB;;AAGOvB,QAAAA,UAAU,GAAE;AAChB;AAAA;AAAA,0CAAYJ,QAAZ,CAAqBC,UAArB;AACA,eAAKY,SAAL;AACH,SAvDwC,CAyDzC;;;AACQP,QAAAA,iBAAiB,GAAE;AACvB,cAAG,CAAC;AAAA;AAAA,0CAAYN,QAAZ,CAAqB4B,MAAtB,IAAgC,CAAC;AAAA;AAAA,0CAAY5B,QAAZ,CAAqB6B,IAAzD,EAA+D;AAC/D,cAAI;AAACC,YAAAA,CAAC,EAACC,OAAH;AAAYC,YAAAA,CAAC,EAACC;AAAd,cAAyB;AAAA;AAAA,0CAAYjC,QAAZ,CAAqB4B,MAAlD;AACA,cAAI;AAACE,YAAAA,CAAC,EAACI,KAAH;AAAUF,YAAAA,CAAC,EAACG,KAAZ;AAAmBC,YAAAA,KAAK,EAACC;AAAzB,cAAsC;AAAA;AAAA,0CAAYrC,QAAZ,CAAqB6B,IAA/D;;AAEA,cAAGE,OAAO,KAAKG,KAAZ,IAAqBD,OAAO,KAAKE,KAAjC,IAA0CE,SAAS,KAAK;AAAA;AAAA,sDAAkBC,KAA7E,EAAmF;AAC/E;AAAA;AAAA,8CAAatC,QAAb,CAAsBuC,IAAtB,CAA2B;AAAA;AAAA,0CAAWpC,UAAtC;AACH;AACJ;;AAEDW,QAAAA,UAAU,GAAE;AACR;AACA,eAAKjB,KAAL,CAAW2C,kBAAX;AACA;AAAA;AAAA,0CAAYxC,QAAZ,CAAqByC,KAArB;AACH;;AAED7B,QAAAA,aAAa,GAAE;AACX;AACA,eAAKf,KAAL,GAAa,IAAItB,IAAJ,EAAb;AACA,eAAKsB,KAAL,CAAW6C,SAAX,CAAqB,KAAKC,IAA1B;AACA,eAAK9C,KAAL,CAAW+C,IAAX,GAAkB,OAAlB;AACH;;AAGKvB,QAAAA,eAAe,GAAE;AAAA;;AAAA;AACnB;AACA,gBAAIwB,OAAO,GAAG,IAAItE,IAAJ,EAAd;AACAsE,YAAAA,OAAO,CAACH,SAAR,CAAkB,MAAI,CAAC7C,KAAvB,EAHmB,CAKnB;;AACA,gBAAMiD,cAAc,GAAGD,OAAO,CAACE,YAAR;AAAA;AAAA,iDAAvB;AACA,kBAAMD,cAAc,CAACE,IAAf,EAAN,CAPmB,CASnB;;AACA,YAAA,MAAI,CAACC,QAAL;AAVmB;AAWtB;;AAGK3B,QAAAA,aAAa,GAAE;AAAA;;AAAA;AACjB,gBAAI4B,OAAO,GAAG,EAAd;;AACA,YAAA,MAAI,CAACtD,KAAL,CAAWuD,MAAX,CAAkBC,OAAlB,CAA2BC,KAAD,IAAS;AAC/B,kBAAMV,IAAI,GAAG;AAAA;AAAA,iDAAb;AACAA,cAAAA,IAAI,CAACD,SAAL,CAAe,MAAI,CAAC7C,KAApB;AACA,kBAAMyD,MAAM,GAAGX,IAAI,CAACI,YAAL;AAAA;AAAA,+CAAf,CAH+B,CAI/B;AACA;;AACAG,cAAAA,OAAO,CAACK,IAAR,CAAaD,MAAM,CAACN,IAAP,CAAYK,KAAZ,CAAb,EAN+B,CAO/B;;AACA;AAAA;AAAA,8CAAYrD,QAAZ,CAAqBmD,MAArB,CAA4BI,IAA5B,CAAiCD,MAAjC;AACH,aATD;;AAWA,kBAAMnC,OAAO,CAACC,GAAR,CAAY8B,OAAZ,CAAN;AAbiB;AAcpB;;AAEKvB,QAAAA,cAAc,GAAE;AAAA;;AAAA;AAClB,gBAAMC,MAAM,GAAG;AAAA;AAAA,+CAAf;AACAA,YAAAA,MAAM,CAACc,SAAP,CAAiB,MAAI,CAAC7C,KAAtB;AACA,gBAAM2D,WAAW,GAAG5B,MAAM,CAACmB,YAAP;AAAA;AAAA,+CAApB;AACA,kBAAMS,WAAW,CAACR,IAAZ,CAAiB,MAAI,CAACpD,KAAL,CAAWgC,MAA5B,CAAN;AACA;AAAA;AAAA,4CAAY5B,QAAZ,CAAqB4B,MAArB,GAA8B4B,WAA9B;AACA;AAAA;AAAA,8CAAaxD,QAAb,CAAsBuC,IAAtB,CAA2B;AAAA;AAAA,0CAAWkB,WAAtC,EAAmD,IAAnD;AANkB;AAQrB;;AAEKlC,QAAAA,cAAc,GAAE;AAAA;;AAAA;AAClB,gBAAI2B,OAAO,GAAG,EAAd;;AACA,YAAA,MAAI,CAACtD,KAAL,CAAW8D,MAAX,CAAkBN,OAAlB,CAA2BO,KAAD,IAAS;AAC/B,kBAAMhB,IAAI,GAAG;AAAA;AAAA,iDAAb;AACAA,cAAAA,IAAI,CAACD,SAAL,CAAe,MAAI,CAAC7C,KAApB;AACA,kBAAMyD,MAAM,GAAGX,IAAI,CAACI,YAAL;AAAA;AAAA,+CAAf,CAH+B,CAI/B;AACA;;AACAG,cAAAA,OAAO,CAACK,IAAR,CAAaD,MAAM,CAACN,IAAP,CAAYW,KAAZ,CAAb,EAN+B,CAO/B;;AACA;AAAA;AAAA,8CAAY3D,QAAZ,CAAqB0D,MAArB,CAA4BH,IAA5B,CAAiCD,MAAjC;AACH,aATD;;AAUA,kBAAMnC,OAAO,CAACC,GAAR,CAAY8B,OAAZ,CAAN;AAZkB;AAarB;;AACK1B,QAAAA,YAAY,GAAE;AAAA;;AAAA;AAChB,gBAAMK,IAAI,GAAG;AAAA;AAAA,+CAAb;AACAA,YAAAA,IAAI,CAACa,SAAL,CAAe,MAAI,CAAC7C,KAApB;AACA,gBAAM+D,WAAW,GAAG/B,IAAI,CAACkB,YAAL;AAAA;AAAA,2CAApB;AACA,kBAAMa,WAAW,CAACZ,IAAZ,CAAiB,MAAI,CAACpD,KAAL,CAAWiC,IAA5B,CAAN;AACA;AAAA;AAAA,4CAAY7B,QAAZ,CAAqB6B,IAArB,GAA4B+B,WAA5B;AALgB;AAMnB;;AAEKnC,QAAAA,aAAa,GAAE;AAAA;;AAAA;AACjB,gBAAIyB,OAAO,GAAG,EAAd;;AACA,YAAA,MAAI,CAACtD,KAAL,CAAWiE,OAAX,CAAmBT,OAAnB,CAA4BU,KAAD,IAAS;AAChC,kBAAMnB,IAAI,GAAG;AAAA;AAAA,iDAAb;AACAA,cAAAA,IAAI,CAACD,SAAL,CAAe,MAAI,CAAC7C,KAApB;AACA,kBAAMkE,MAAM,GAAGD,KAAK,CAACE,IAAN,KAAe;AAAA;AAAA,wDAAiBC,eAAhC;AAAA;AAAA;AAAA;AAAA,4DAAf;AACA,kBAAMX,MAAM,GAAGX,IAAI,CAACI,YAAL,CAAkBgB,MAAlB,CAAf,CAJgC,CAKhC;AACA;;AACAb,cAAAA,OAAO,CAACK,IAAR,CAAaD,MAAM,CAACN,IAAP,CAAYc,KAAZ,CAAb,EAPgC,CAQhC;;AACA;AAAA;AAAA,8CAAY9D,QAAZ,CAAqB6D,OAArB,CAA6BN,IAA7B,CAAkCD,MAAlC;AACH,aAVD;;AAYA,kBAAMnC,OAAO,CAACC,GAAR,CAAY8B,OAAZ,CAAN;AAdiB;AAepB;;AAEK1C,QAAAA,aAAa,CAACsB,CAAD,EAAWE,CAAX,EAAqBkC,SAArB,EAA8C;AAAA;;AAAA;AAC7D;AACA,gBAAMC,IAAI,GAAG;AAAA;AAAA,4CAAYnE,QAAZ,CAAqBoE,MAArB,CAA4BC,IAA5B,CAAiCC,KAAK,IAAEA,KAAK,CAAClC,KAAN,KAAgB;AAAA;AAAA,wDAAkBE,KAA1E,CAAb;;AACA,gBAAG6B,IAAH,EAAQ;AACJA,cAAAA,IAAI,CAACrC,CAAL,GAASA,CAAT;AACAqC,cAAAA,IAAI,CAACnC,CAAL,GAASA,CAAT;AACAmC,cAAAA,IAAI,CAACD,SAAL,GAAiBA,SAAjB,CAHI,CAIJ;;AACA,cAAA,MAAI,CAACvB,IAAL,CAAU4B,WAAV,CAAsBzC,CAAC;AAAA;AAAA,2CAAD,GAAiB;AAAA;AAAA,8CAAa,GAApD,EAAyD,CAACE,CAAD;AAAA;AAAA,gDAAmB;AAAA;AAAA,gDAAc,GAA1F;;AACA;AACH;;AAED,gBAAMsC,KAAK,GAAG;AAAA;AAAA,+CAAd;AACAA,YAAAA,KAAK,CAAC5B,SAAN,CAAgB,MAAI,CAAC5C,WAArB;AACA,gBAAM0E,YAAY,GAAGF,KAAK,CAACvB,YAAN;AAAA;AAAA,6CAArB;AACA,kBAAMyB,YAAY,CAACxB,IAAb,CAAkB;AACpBlB,cAAAA,CADoB;AAEpBE,cAAAA,CAFoB;AAGpBkC,cAAAA,SAHoB;AAIpB9B,cAAAA,KAAK,EAAC;AAAA;AAAA,0DAAkBqC,IAJJ;AAKpBT,cAAAA,IAAI,EAAC;AAAA;AAAA,wDAAiBU;AALF,aAAlB,CAAN;AAOA;AAAA;AAAA,4CAAY1E,QAAZ,CAAqBoE,MAArB,CAA4Bb,IAA5B,CAAiCiB,YAAjC;AAtB6D;AAuBhE;;AAEK9C,QAAAA,kBAAkB,GAAE;AAAA;;AAAA;AACtB,YAAA,MAAI,CAAC5B,WAAL,GAAmB;AAAA;AAAA,+CAAnB;;AACA,YAAA,MAAI,CAACA,WAAL,CAAiB4C,SAAjB,CAA2B,MAAI,CAAC7C,KAAhC;AAFsB;AAGzB;;AACDoD,QAAAA,QAAQ,GAAE;AACN;AACA;AACA,cAAM;AAACjC,YAAAA,WAAD;AAAcE,YAAAA;AAAd,cAAgC;AAAA;AAAA,0CAAYlB,QAAlD;AACA,cAAM2E,IAAI,GAAG;AAAA;AAAA,0CAAa3D,WAAb,GAAyB,CAAtC;AACA,cAAM4D,IAAI,GAAG;AAAA;AAAA,4CAAc1D,cAAd,GAA6B,CAA7B,GAAiC,GAA9C;AACA,eAAKrB,KAAL,CAAW0E,WAAX,CAAuB,CAACI,IAAxB,EAA8BC,IAA9B;AAEH;;AAtMwC,O","sourcesContent":["import { _decorator, Component, director, Node } from 'cc';\r\nimport { TileMapManager } from '../tile/TileMapManager';\r\nimport levels, { ILevel } from '../../levels';\r\nimport DataManager from '../../runtime/DataManager';\r\nimport { TILE_HEIGHT, TILE_WIDTH } from '../tile/TileManger';\r\nimport EventManager from '../../runtime/EventManager';\r\nimport { DIRECTION_ENUM, ENTITY_STATE_ENUM, ENTITY_TYPE_ENUM, EVENT_ENUM } from '../../enums';\r\nimport { createUINode } from '../../utils';\r\nimport { PlayerManager } from '../player/PlayerManager';\r\nimport { WoodenSkeletonManager } from '../woodenSkeleton/WoodenSkeletonManager';\r\nimport { DoorManager } from '../door/DoorManager';\r\nimport { IronSkeletonManager } from '../ironSkeleton/IronSkeletonManager';\r\nimport { BurstManager } from '../burst/BurstManager';\r\nimport { SpikeManager } from '../spikes/SpikeManager';\r\nimport { SmokeManager } from '../smoke/SmokeManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('BattleManager')\r\nexport class BattleManager extends Component {\r\n    level:ILevel;\r\n    stage:Node;\r\n    //分层渲染的思想很重要\r\n    private _smokeLayer:Node;\r\n\r\n    //\r\n    onLoad(){\r\n        DataManager.Instance.levelIndex = 4;\r\n        //绑定切换关卡\r\n        EventManager.Instance.on(EVENT_ENUM.NEXT_LEVEL, this._nextLevel, this);\r\n        EventManager.Instance.on(EVENT_ENUM.PLAYER_MOVE_END, this._checkArrivedDoor, this);\r\n        EventManager.Instance.on(EVENT_ENUM.SHOW_SMOKE, this.generateSmoke, this);\r\n    }\r\n\r\n    onDestroy(){\r\n        //解绑切换关卡\r\n        EventManager.Instance.off(EVENT_ENUM.NEXT_LEVEL, this._nextLevel)\r\n        EventManager.Instance.off(EVENT_ENUM.PLAYER_MOVE_END, this._checkArrivedDoor);\r\n        EventManager.Instance.off(EVENT_ENUM.SHOW_SMOKE, this.generateSmoke, this);\r\n    }\r\n\r\n    start() {\r\n        this.generateStage();\r\n        this.initLevel();\r\n    }\r\n\r\n    async initLevel(){\r\n        const level = levels[`level${DataManager.Instance.levelIndex}`];\r\n        if(level){\r\n            this.clearLevel();\r\n            this.level = level;\r\n            DataManager.Instance.mapInfo = this.level.mapInfo;\r\n            DataManager.Instance.mapRowCount = this.level.mapInfo.length || 0;\r\n            DataManager.Instance.mapColumnCount = this.level.mapInfo[0].length || 0;\r\n            \r\n            await Promise.all([\r\n                this.generateTileMap(),\r\n                this.generateBurst(),\r\n                this.generateSpikes(),\r\n                this.generateDoor(),\r\n                this.generateEnemy(),    \r\n            ]);\r\n            //生成player\r\n            await this.generateSmokeLayer();\r\n            await this.generatePlayer();\r\n            \r\n            \r\n        }\r\n    }\r\n\r\n\r\n    private _nextLevel(){\r\n        DataManager.Instance.levelIndex++;\r\n        this.initLevel();\r\n    }\r\n\r\n    //检测玩家是否到门，且敌人全部死亡\r\n    private _checkArrivedDoor(){\r\n        if(!DataManager.Instance.player || !DataManager.Instance.door) return;\r\n        let {x:playerX, y:playerY} = DataManager.Instance.player;\r\n        let {x:doorX, y:doorY, state:doorState} = DataManager.Instance.door;\r\n        \r\n        if(playerX === doorX && playerY === doorY && doorState === ENTITY_STATE_ENUM.DEATH){\r\n            EventManager.Instance.emit(EVENT_ENUM.NEXT_LEVEL);\r\n        }\r\n    }\r\n\r\n    clearLevel(){\r\n        //清空数据，销毁上一关地图后再加载下一关\r\n        this.stage.destroyAllChildren();\r\n        DataManager.Instance.reset();\r\n    }\r\n\r\n    generateStage(){\r\n        //创建舞台，所有单元放在舞台上\r\n        this.stage = new Node();\r\n        this.stage.setParent(this.node);\r\n        this.stage.name = \"stage\";\r\n    }\r\n\r\n\r\n    async generateTileMap(){\r\n        //创建瓦片地图节点\r\n        let tileMap = new Node();\r\n        tileMap.setParent(this.stage);\r\n\r\n        //执行生成逻辑，放在组件上\r\n        const tileMapManager = tileMap.addComponent(TileMapManager);\r\n        await tileMapManager.init();\r\n\r\n        //地图居中\r\n        this.adaptPos();\r\n    }\r\n\r\n\r\n    async generateBurst(){\r\n        let promise = [];\r\n        this.level.bursts.forEach((burst)=>{\r\n            const node = createUINode();\r\n            node.setParent(this.stage);\r\n            const manger = node.addComponent(BurstManager);\r\n            //使用promise，避免等一个创造一个\r\n            //可以一起等待，提高资源加载速度\r\n            promise.push(manger.init(burst));\r\n            //注意名字大小写，大写是类名\r\n            DataManager.Instance.bursts.push(manger); \r\n        })\r\n\r\n        await Promise.all(promise);\r\n    }\r\n\r\n    async generatePlayer(){\r\n        const player = createUINode();\r\n        player.setParent(this.stage);\r\n        const playManager = player.addComponent(PlayerManager);\r\n        await playManager.init(this.level.player);\r\n        DataManager.Instance.player = playManager;\r\n        EventManager.Instance.emit(EVENT_ENUM.PLAYER_BORN, true);\r\n        \r\n    }\r\n\r\n    async generateSpikes(){\r\n        let promise = [];\r\n        this.level.spikes.forEach((spike)=>{\r\n            const node = createUINode();\r\n            node.setParent(this.stage);\r\n            const manger = node.addComponent(SpikeManager);\r\n            //使用promise，避免等一个创造一个\r\n            //可以一起等待，提高资源加载速度\r\n            promise.push(manger.init(spike));\r\n            //注意名字大小写，大写是类名\r\n            DataManager.Instance.spikes.push(manger); \r\n        })\r\n        await Promise.all(promise);\r\n    }\r\n    async generateDoor(){\r\n        const door = createUINode();\r\n        door.setParent(this.stage);\r\n        const doorManager = door.addComponent(DoorManager);\r\n        await doorManager.init(this.level.door);\r\n        DataManager.Instance.door = doorManager;\r\n    }\r\n\r\n    async generateEnemy(){\r\n        let promise = [];\r\n        this.level.enemies.forEach((enemy)=>{\r\n            const node = createUINode();\r\n            node.setParent(this.stage);\r\n            const Manger = enemy.type === ENTITY_TYPE_ENUM.SKELETON_WOODEN ? WoodenSkeletonManager : IronSkeletonManager;\r\n            const manger = node.addComponent(Manger);\r\n            //使用promise，避免等一个创造一个\r\n            //可以一起等待，提高资源加载速度\r\n            promise.push(manger.init(enemy));\r\n            //注意名字大小写，大写是类名\r\n            DataManager.Instance.enemies.push(manger); \r\n        })\r\n\r\n        await Promise.all(promise);\r\n    }\r\n\r\n    async generateSmoke(x:number, y:number, direction:DIRECTION_ENUM){\r\n        //循环利用\r\n        const item = DataManager.Instance.smokes.find(smoke=>smoke.state === ENTITY_STATE_ENUM.DEATH);\r\n        if(item){\r\n            item.x = x;\r\n            item.y = y;\r\n            item.direction = direction;\r\n            //重新设置一下位置，保证烟雾生成的位置是实际希望的位置\r\n            this.node.setPosition(x * TILE_WIDTH - TILE_WIDTH * 1.5, -y * TILE_HEIGHT + TILE_HEIGHT * 1.5);\r\n            return;\r\n        }\r\n        \r\n        const smoke = createUINode();\r\n        smoke.setParent(this._smokeLayer);\r\n        const smokeManager = smoke.addComponent(SmokeManager);\r\n        await smokeManager.init({\r\n            x,\r\n            y,\r\n            direction,\r\n            state:ENTITY_STATE_ENUM.IDLE,\r\n            type:ENTITY_TYPE_ENUM.SMOKE\r\n        });\r\n        DataManager.Instance.smokes.push(smokeManager);\r\n    }\r\n\r\n    async generateSmokeLayer(){\r\n        this._smokeLayer = createUINode();\r\n        this._smokeLayer.setParent(this.stage);\r\n    }\r\n    adaptPos(){\r\n        //将舞台置为中间位置\r\n        //解包\r\n        const {mapRowCount, mapColumnCount} = DataManager.Instance;\r\n        const disX = TILE_WIDTH * mapRowCount/2;\r\n        const disY = TILE_HEIGHT * mapColumnCount/2 + 100;\r\n        this.stage.setPosition(-disX, disY);\r\n\r\n    }\r\n}\r\n\r\n\r\n"]}