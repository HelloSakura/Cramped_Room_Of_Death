{"version":3,"sources":["file:///E:/git/Cramped_Room_Of_Death/assets/scripts/woodenSkeleton/WoodenSkeletonManager.ts"],"names":["_decorator","ENTITY_STATE_ENUM","EVENT_ENUM","EventManager","WoodenSkeletonStateMachine","DataManager","EnemyManager","ccclass","property","WoodenSkeletonManager","onDestroy","Instance","off","PLAYER_MOVE_END","_onAttack","init","params","fsm","addComponent","on","state","DEATH","player","x","playerX","y","playerY","playerState","Math","abs","AIRDEATH","ATTACK","emit","ATTACK_PLAYER","IDLE"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;;AACiBC,MAAAA,iB,iBAAAA,iB;AAAqCC,MAAAA,U,iBAAAA,U;;AACxDC,MAAAA,Y;;AACEC,MAAAA,0B,iBAAAA,0B;;AACFC,MAAAA,W;;AACEC,MAAAA,Y,iBAAAA,Y;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBR,U;;uCAMjBS,qB,WADZF,OAAO,CAAC,uBAAD,C,gBAAR,MACaE,qBADb;AAAA;AAAA,wCACwD;AAEpDC,QAAAA,SAAS,GAAS;AACd,gBAAMA,SAAN;AACA;AAAA;AAAA,4CAAaC,QAAb,CAAsBC,GAAtB,CAA0B;AAAA;AAAA,wCAAWC,eAArC,EAAsD,KAAKC,SAA3D;AACH;;AAEKC,QAAAA,IAAI,CAACC,MAAD,EAAQ;AAAA;AAAA;;AAAA;AACd;AACA,YAAA,KAAI,CAACC,GAAL,GAAW,KAAI,CAACC,YAAL;AAAA;AAAA,yEAAX;AACA,kBAAM,KAAI,CAACD,GAAL,CAASF,IAAT,EAAN;;AACA,6CAAWC,MAAX;;AACA;AAAA;AAAA,8CAAaL,QAAb,CAAsBQ,EAAtB,CAAyB;AAAA;AAAA,0CAAWN,eAApC,EAAqD,KAAI,CAACC,SAA1D,EAAqE,KAArE;AALc;AAMjB;;AAGOA,QAAAA,SAAS,GAAE;AACf,cAAG,KAAKM,KAAL,KAAe;AAAA;AAAA,sDAAkBC,KAAjC,IAA0C,CAAC;AAAA;AAAA,0CAAYV,QAAZ,CAAqBW,MAAnE,EAA2E;AAE3E,cAAM;AAACC,YAAAA,CAAC,EAACC,OAAH;AAAYC,YAAAA,CAAC,EAACC,OAAd;AAAuBN,YAAAA,KAAK,EAACO;AAA7B,cAA4C;AAAA;AAAA,0CAAYhB,QAAZ,CAAqBW,MAAvE;;AACA,cACG,CAAE,KAAKC,CAAL,KAAWC,OAAX,IAAsBI,IAAI,CAACC,GAAL,CAAS,KAAKJ,CAAL,GAASC,OAAlB,KAA8B,CAArD,IACA,KAAKD,CAAL,KAAWC,OAAX,IAAsBE,IAAI,CAACC,GAAL,CAAS,KAAKN,CAAL,GAASC,OAAlB,KAA8B,CADrD,KAECG,WAAW,KAAK;AAAA;AAAA,sDAAkBN,KAFnC,IAGCM,WAAW,KAAK;AAAA;AAAA,sDAAkBG,QAJtC,EAKC;AACG,iBAAKV,KAAL,GAAa;AAAA;AAAA,wDAAkBW,MAA/B;AACA;AAAA;AAAA,8CAAapB,QAAb,CAAsBqB,IAAtB,CAA2B;AAAA;AAAA,0CAAWC,aAAtC,EAAqD;AAAA;AAAA,wDAAkBZ,KAAvE;AACH,WARD,MASI;AACA,iBAAKD,KAAL,GAAa;AAAA;AAAA,wDAAkBc,IAA/B;AACH;AAEJ;;AAjCmD,O","sourcesContent":["import { _decorator } from 'cc';\r\nimport {  DIRECTION_ENUM, ENTITY_STATE_ENUM, ENTITY_TYPE_ENUM, EVENT_ENUM } from '../../enums';\r\nimport EventManager from '../../runtime/EventManager';\r\nimport { WoodenSkeletonStateMachine } from './WoodenSkeletonStateMachine';\r\nimport DataManager from '../../runtime/DataManager';\r\nimport { EnemyManager } from '../../base/EnemyManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n\r\n\r\n\r\n@ccclass('WoodenSkeletonManager')\r\nexport class WoodenSkeletonManager extends EnemyManager {\r\n    \r\n    onDestroy(): void {\r\n        super.onDestroy();\r\n        EventManager.Instance.off(EVENT_ENUM.PLAYER_MOVE_END, this._onAttack);  \r\n    }\r\n    \r\n    async init(params){   \r\n        //添加状态机\r\n        this.fsm = this.addComponent(WoodenSkeletonStateMachine);\r\n        await this.fsm.init();\r\n        super.init(params);\r\n        EventManager.Instance.on(EVENT_ENUM.PLAYER_MOVE_END, this._onAttack, this);     \r\n    }\r\n\r\n\r\n    private _onAttack(){\r\n        if(this.state === ENTITY_STATE_ENUM.DEATH || !DataManager.Instance.player) return;\r\n\r\n        const {x:playerX, y:playerY, state:playerState} = DataManager.Instance.player;\r\n        if(\r\n           ((this.x === playerX && Math.abs(this.y - playerY) <= 1)\r\n        || (this.y === playerY && Math.abs(this.x - playerX) <= 1))\r\n        && (playerState !== ENTITY_STATE_ENUM.DEATH)\r\n        && (playerState !== ENTITY_STATE_ENUM.AIRDEATH)\r\n        ){\r\n            this.state = ENTITY_STATE_ENUM.ATTACK;\r\n            EventManager.Instance.emit(EVENT_ENUM.ATTACK_PLAYER, ENTITY_STATE_ENUM.DEATH);\r\n        }\r\n        else{\r\n            this.state = ENTITY_STATE_ENUM.IDLE;\r\n        }\r\n         \r\n    }\r\n\r\n}\r\n\r\n\r\n"]}